<div class="activity-detail-page">
  <!-- Loading -->
  @if (isLoading) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Učitavanje...</p>
  </div>
  }

  <!-- Error -->
  @if (error) {
  <div class="error-container">
    <p>{{ error }}</p>
    <a routerLink="/home" class="btn-back">Nazad na početnu</a>
  </div>
  }

  <!-- Content -->
  @if (activity && !isLoading) {
  <div class="content">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a routerLink="/home">Početna</a>
      <span class="separator">›</span>
      <a routerLink="/activities">Aktivnosti</a>
      <span class="separator">›</span>
      <span class="current">{{ activity.name }}</span>
    </div>

    <!-- Main content -->
    <div class="main-content">
      <!-- Left side -->
      <div class="left-column">
        <!-- Header -->
        <div class="activity-header">
          <span class="category-badge">{{ activity.category }}</span>
          <h1>{{ activity.name }}</h1>
          <div class="institution-info">
            <span class="by">by</span>
            <a class="institution-name">{{ activity.institution.name }}</a>
          </div>
        </div>

        <!-- Image -->
        <div class="image-container">
          <img [src]="getImageUrl()" [alt]="activity.name" />
        </div>

        <!-- Institution card -->
        <div class="institution-card">
          <div class="institution-avatar">
            {{ activity.institution.name.charAt(0).toUpperCase() }}
          </div>
          <div class="institution-details">
            <h3>{{ activity.institution.name }}</h3>
            <p>{{ activity.institution.email }}</p>
          </div>
        </div>

        <!-- Description -->
        <div class="section">
          <h2>O aktivnosti</h2>
          <p class="description">{{ activity.description }}</p>
        </div>

        <!-- Reviews section placeholder -->
        <div class="section">
          <h2>Recenzije</h2>
          <p class="no-reviews">Još uvek nema recenzija za ovu aktivnost.</p>
        </div>
      </div>

      <!-- Right side - Booking card -->
      <div class="right-column">
        <div class="booking-card">
          <!-- Age & Rating -->
          <div class="booking-info">
            <div class="info-item">
              <i class="fa-solid fa-users"></i>
              <span>Uzrast: {{ activity.age_from }} - {{ activity.age_to }} god.</span>
            </div>

            @if (getNextAvailableDate()) {
            <div class="info-item">
              <i class="fa-solid fa-calendar"></i>
              <span>{{ getNextAvailableDate() }}</span>
              @if (activity.time_slots.length > 1) {
              <a class="more-link">+ još termina</a>
              }
            </div>
            } @if (getUniqueLocations().length > 0) {
            <div class="info-item">
              <i class="fa-solid fa-location-dot"></i>
              <span>{{ getUniqueLocations()[0] }}</span>
              @if (getUniqueLocations().length > 1) {
              <a class="more-link">+ još lokacija</a>
              }
            </div>
            }
          </div>

          <!-- Price -->
          <div class="price-section">
            <span class="price">{{ activity.price | number : '1.0-0' }} RSD</span>
            <span class="price-label">po terminu</span>
          </div>

          <!-- Slots -->
          @if (activity.time_slots && activity.time_slots.length > 0) {
          <div class="slots-section">
            <h3>Izaberite termin</h3>
            <div class="slots-list">
              @for (slot of activity.time_slots; track slot.id) {
              <div
                class="slot-item"
                [class.selected]="selectedSlot?.id === slot.id"
                [class.full]="getAvailableSpots(slot) === 0"
                (click)="getAvailableSpots(slot) > 0 && selectSlot(slot)"
              >
                <div class="slot-date">{{ formatDate(slot.date) }}</div>
                <div class="slot-time">
                  {{ formatTime(slot.time_from) }} - {{ formatTime(slot.time_to) }}
                </div>
                <div class="slot-location">{{ slot.location.city }}</div>
                <div class="slot-spots" [class.low]="getAvailableSpots(slot) <= 3">
                  {{ getAvailableSpots(slot) }}
                  {{ getAvailableSpots(slot) === 1 ? 'mesto' : 'mesta' }}
                </div>
              </div>
              }
            </div>
          </div>
          } @else {
          <div class="no-slots">
            <p>Trenutno nema dostupnih termina.</p>
          </div>
          }

          <!-- CTA Button -->
          @if (authService.isLoggedIn() && authService.isParent()) {
          <button class="btn-book" [disabled]="!selectedSlot" (click)="openReservationModal()">
            Rezerviši termin
          </button>
          } @if (!authService.isLoggedIn()) {
          <a routerLink="/login" class="btn-book"> Prijavi se za rezervaciju </a>
          <p class="login-hint">Morate biti prijavljeni da biste rezervisali termin</p>
          }
        </div>
      </div>
    </div>
  </div>
  }
</div>
